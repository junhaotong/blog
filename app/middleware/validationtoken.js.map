{
    "version": 3,
    "sources": [
        "../../src/middleware/validationtoken.js"
    ],
    "names": [
        "module",
        "exports",
        "options",
        "app",
        "ctx",
        "next",
        "token",
        "headers",
        "authorization",
        "url",
        "indexOf",
        "fail",
        "userService",
        "service",
        "user",
        "getUserByToken",
        "id",
        "type"
    ],
    "mappings": ";;AAAAA,OAAOC,OAAP,GAAiB,CAACC,OAAD,EAAUC,GAAV,KAAkB;AAC/B;AAAA,qCAAO,WAAOC,GAAP,EAAYC,IAAZ,EAAqB;AACxB,gBAAIC,QAAQF,IAAIG,OAAJ,CAAYC,aAAxB;AACA,gBAAIF,UAAU,WAAV,IAAyB,CAACA,KAAD,IAAUF,IAAIK,GAAJ,CAAQC,OAAR,CAAgB,QAAhB,IAA4B,CAAtC,IAA2CN,IAAIK,GAAJ,CAAQC,OAAR,CAAgB,SAAhB,IAA6B,CAArG,EAAwG;AACpG,uBAAON,IAAIO,IAAJ,CAAS,IAAT,EAAe,KAAf,CAAP;AACH;AACD,gBAAIC,cAAcR,IAAIS,OAAJ,CAAY,MAAZ,CAAlB;AACA,gBAAIC,OAAO,MAAMF,YAAYG,cAAZ,CAA2BT,KAA3B,CAAjB;AACA,gBAAI,CAACQ,KAAKE,EAAV,EAAc,OAAOZ,IAAIO,IAAJ,CAAS,IAAT,EAAe,KAAf,CAAP;AACd,gBAAIP,IAAIK,GAAJ,CAAQC,OAAR,CAAgB,QAAhB,KAA6B,CAA7B,IAAkCI,KAAKG,IAAL,GAAY,CAAlD,EAAqD;AACjD;AACA,uBAAOb,IAAIO,IAAJ,CAAS,IAAT,EAAe,KAAf,CAAP;AACH;AACDP,gBAAIU,IAAJ,GAAWA,IAAX;AACA,mBAAOT,MAAP;AACH,SAdD;;AAAA;AAAA;AAAA;AAAA;AAeH,CAhBD",
    "file": "../../src/middleware/validationtoken.js",
    "sourcesContent": [
        "module.exports = (options, app) => {\n    return async (ctx, next) => {\n        let token = ctx.headers.authorization;\n        if (token === 'undefined' || !token && ctx.url.indexOf('/login') < 0 && ctx.url.indexOf('/regist') < 0) {\n            return ctx.fail(3000, '未登录');\n        }\n        let userService = ctx.service('user');\n        let user = await userService.getUserByToken(token);\n        if (!user.id) return ctx.fail(3000, '未登录')\n        if (ctx.url.indexOf('/admin') >= 0 && user.type < 2) {\n            // 无权限访问后台接口\n            return ctx.fail(3000, '未登录')\n        }\n        ctx.user = user;\n        return next();\n    };\n};\n"
    ]
}