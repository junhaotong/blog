{
    "version": 3,
    "sources": [
        "../../src/controller/post.js"
    ],
    "names": [
        "Base",
        "require",
        "striptags",
        "moment",
        "lang",
        "module",
        "exports",
        "getAction",
        "id",
        "get",
        "postService",
        "service",
        "updateHot",
        "post",
        "getPostById",
        "tags",
        "JSON",
        "parse",
        "time",
        "update_time",
        "create_time",
        "fromNow",
        "success",
        "posts",
        "getPostsByHot",
        "data",
        "forEach",
        "postAction",
        "ctx",
        "user",
        "user_ID",
        "fail",
        "config",
        "length",
        "description",
        "substr",
        "addPost"
    ],
    "mappings": ";;AAAA,MAAMA,OAAOC,QAAQ,WAAR,CAAb;AACA,MAAMC,YAAYD,QAAQ,WAAR,CAAlB;AACA,MAAME,SAASF,QAAQ,QAAR,CAAf;AACAE,OAAOC,IAAP,CAAY,OAAZ;;AAEAC,OAAOC,OAAP,GAAiB,cAAcN,IAAd,CAAmB;AAC1BO,aAAN,GAAkB;AAAA;;AAAA;AACd,gBAAIC,KAAK,MAAKC,GAAL,CAAS,IAAT,CAAT;AACA,gBAAIC,cAAc,MAAKC,OAAL,CAAa,MAAb,CAAlB;;AAEA,gBAAIH,EAAJ,EAAQ;AACJ,sBAAME,YAAYE,SAAZ,CAAsB,MAAKH,GAAL,CAAS,IAAT,CAAtB,CAAN;AACA,oBAAII,OAAO,MAAMH,YAAYI,WAAZ,CAAwB,MAAKL,GAAL,CAAS,IAAT,CAAxB,CAAjB;AACAI,qBAAKE,IAAL,GAAYC,KAAKC,KAAL,CAAWJ,KAAKE,IAAhB,CAAZ;AACAF,qBAAKK,IAAL,GAAYf,OAAOU,KAAKM,WAAL,IAAoBN,KAAKO,WAAhC,EAA6CC,OAA7C,EAAZ;AACA,uBAAO,MAAKC,OAAL,CAAaT,IAAb,EAAmB,OAAnB,CAAP;AACH,aAND,MAMO;AACH,oBAAIU,QAAQ,MAAMb,YAAYc,aAAZ,CAA0B,MAAKf,GAAL,CAAS,MAAT,KAAoB,CAA9C,CAAlB;AACAc,sBAAME,IAAN,CAAWC,OAAX,CAAmB,gBAAQ;AACvBb,yBAAKE,IAAL,GAAYC,KAAKC,KAAL,CAAWJ,KAAKE,IAAhB,CAAZ;AACAF,yBAAKK,IAAL,GAAYf,OAAOU,KAAKM,WAAL,IAAoBN,KAAKO,WAAhC,EAA6CC,OAA7C,EAAZ;AACH,iBAHD;AAIA,uBAAO,MAAKC,OAAL,CAAaC,KAAb,EAAoB,OAApB,CAAP;AACH;AAjBa;AAkBjB;;AAEKI,cAAN,GAAmB;AAAA;;AAAA;AACf,gBAAI,CAAC,OAAKC,GAAL,CAASC,IAAT,CAAcC,OAAnB,EAA4B,OAAO,OAAKC,IAAL,CAAU,OAAKC,MAAL,CAAY,cAAZ,CAAV,EAAuC,KAAvC,CAAP;;AAE5B,gBAAI,OAAKnB,IAAL,CAAU,MAAV,EAAkBoB,MAAlB,GAA2B,CAA/B,EAAkC,OAAO,OAAKF,IAAL,CAAU,OAAKC,MAAL,CAAY,cAAZ,CAAV,EAAuC,UAAvC,CAAP;AAClC,gBAAItB,cAAc,OAAKC,OAAL,CAAa,MAAb,CAAlB;;AAEA,gBAAIuB,cAAchC,UAAU,OAAKW,IAAL,CAAU,SAAV,CAAV,CAAlB;AACAqB,0BAAcA,YAAYC,MAAZ,CAAmB,CAAnB,EAAsB,GAAtB,CAAd;AACA,gBAAI3B,KAAK,MAAME,YAAY0B,OAAZ,CAAoB,OAAKvB,IAAL,CAAU,OAAV,CAApB,EAAwC,OAAKA,IAAL,CAAU,SAAV,CAAxC,EAA8D,OAAKA,IAAL,CAAU,aAAV,CAA9D,EAAuF,OAAKe,GAAL,CAASC,IAAT,CAAcC,OAArG,EAA8G,OAAKjB,IAAL,CAAU,MAAV,CAA9G,EAAiIqB,WAAjI,CAAf;AACA,gBAAI1B,EAAJ,EAAQ;AACJ,uBAAO,OAAKc,OAAL,CAAa,EAACd,IAAIA,EAAL,EAAb,EAAuB,OAAvB,CAAP;AACH,aAFD,MAEO;AACH,uBAAO,OAAKuB,IAAL,CAAU,OAAKC,MAAL,CAAY,cAAZ,CAAV,EAAuC,OAAvC,CAAP;AACH;AAbc;AAclB;AAnC+B,CAApC",
    "file": "../../src/controller/post.js",
    "sourcesContent": [
        "const Base = require('./base.js');\nconst striptags = require('striptags');\nconst moment = require('moment');\nmoment.lang('zh-cn');\n\nmodule.exports = class extends Base {\n    async getAction() {\n        let id = this.get('id');\n        let postService = this.service('post');\n\n        if (id) {\n            await postService.updateHot(this.get('id'));\n            let post = await postService.getPostById(this.get('id'));\n            post.tags = JSON.parse(post.tags);\n            post.time = moment(post.update_time || post.create_time).fromNow();\n            return this.success(post, '查询成功!');\n        } else {\n            let posts = await postService.getPostsByHot(this.get('page') || 1);\n            posts.data.forEach(post => {\n                post.tags = JSON.parse(post.tags);\n                post.time = moment(post.update_time || post.create_time).fromNow();\n            })\n            return this.success(posts, '获取成功!');\n        }\n    }\n\n    async postAction() {\n        if (!this.ctx.user.user_ID) return this.fail(this.config('unLoginErrno'), '未登录');\n\n        if (this.post('tags').length > 5) return this.fail(this.config('defaultErrno'), '最多添加5个标签');\n        let postService = this.service('post');\n\n        let description = striptags(this.post('content'));\n        description = description.substr(0, 300);\n        let id = await postService.addPost(this.post('title'), this.post('content'), this.post('category_id'),this.ctx.user.user_ID, this.post('tags'), description);\n        if (id) {\n            return this.success({id: id}, '发布成功!');\n        } else {\n            return this.fail(this.config('defaultErrno'), '发布失败!');\n        }\n    }\n};\n"
    ]
}